<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winget Pro - V31 Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --bg-main: #0f172a; --card-bg: #1e293b; --accent: #3b82f6; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-main); color: #f1f5f9; user-select: none; overflow: hidden; }
        
        /* Cards */
        .app-card { transition: all 0.2s; border: 1px solid #334155; background-color: var(--card-bg); }
        .app-card:hover { border-color: var(--accent); transform: translateY(-2px); background-color: #1f2937; }
        
        /* Checkboxes */
        .app-checkbox:checked + .app-content { background: linear-gradient(145deg, #1e3a8a, #172554); border-color: var(--accent); }
        .app-checkbox:checked + .app-content .check-icon { opacity: 1; transform: scale(1); }
        .app-checkbox:checked + .app-content .app-id { color: #93c5fd; }

        /* Donation Cards */
        .donate-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }
        .donate-card:hover {
            border-color: #10b981;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.3);
        }

        /* Utils */
        .loader { border: 2px solid rgba(255,255,255,0.1); border-top: 2px solid #3b82f6; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s infinite linear; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div class="flex h-screen">
        
        <!-- MENU LATERAL -->
        <aside class="w-72 bg-slate-900 border-r border-slate-800 flex flex-col hidden md:flex z-20 shrink-0">
            <div class="p-6 border-b border-slate-800 flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                    <i class="fa-solid fa-box-open text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold">Winget<span class="text-blue-500">Pro</span></h1>
                    <span class="text-[10px] bg-slate-800 text-slate-400 px-2 py-0.5 rounded border border-slate-700">v1.0 Stable</span>
                </div>
            </div>
            
            <div class="p-4 flex-1 overflow-y-auto space-y-6">
                
                <!-- Navegação -->
                <nav class="space-y-2">
                    <button onclick="switchTab('home')" id="nav-home" class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl bg-blue-600 text-white shadow-md transition-all text-left">
                        <i class="fa-solid fa-layer-group w-5 text-center"></i> Biblioteca
                    </button>
                    <button onclick="switchTab('about')" id="nav-about" class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-slate-400 hover:bg-slate-800 transition-all text-left">
                        <i class="fa-solid fa-circle-info w-5 text-center"></i> Sobre & Ajuda
                    </button>
                    <button onclick="switchTab('donate')" id="nav-donate" class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-slate-400 hover:bg-slate-800 hover:text-emerald-400 transition-all text-left group">
                        <i class="fa-solid fa-heart w-5 text-center group-hover:text-red-500 transition-colors"></i> Apoie o Projeto
                    </button>
                </nav>

                <!-- Kits Rápidos -->
                <div>
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase px-2 mb-2">Kits Rápidos</h3>
                    <div class="space-y-2">
                        <button onclick="applyPreset('basic')" class="w-full text-left px-4 py-2.5 rounded-lg text-sm text-slate-300 hover:bg-slate-800 border border-transparent hover:border-slate-700 transition flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]"></span> Essencial
                        </button>
                        <button onclick="applyPreset('gamer')" class="w-full text-left px-4 py-2.5 rounded-lg text-sm text-slate-300 hover:bg-slate-800 border border-transparent hover:border-slate-700 transition flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-purple-500 shadow-[0_0_8px_rgba(168,85,247,0.6)]"></span> Gamer
                        </button>
                        <button onclick="applyPreset('dev')" class="w-full text-left px-4 py-2.5 rounded-lg text-sm text-slate-300 hover:bg-slate-800 border border-transparent hover:border-slate-700 transition flex items-center gap-3">
                            <span class="w-2 h-2 rounded-full bg-orange-500 shadow-[0_0_8px_rgba(249,115,22,0.6)]"></span> Dev Pack
                        </button>
                    </div>
                </div>
            </div>

            <!-- Área de Download -->
            <div class="p-4 border-t border-slate-800 bg-slate-900">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Selecionados</span>
                    <!-- CORREÇÃO: ID alterado de 'count' para 'sidebarCount' para coincidir com o JS -->
                    <span id="sidebarCount" class="bg-blue-600 text-white text-[10px] px-2 py-0.5 rounded-full font-bold">0</span>
                </div>
                <button onclick="downloadPackage()" id="dlBtn" disabled class="w-full bg-emerald-600 hover:bg-emerald-500 disabled:bg-slate-800 disabled:text-slate-600 disabled:border disabled:border-slate-700 disabled:cursor-not-allowed text-white text-xs font-bold py-3 rounded-lg transition-all shadow-lg flex items-center justify-center gap-2 group">
                    <i class="fa-solid fa-file-zipper text-sm group-hover:scale-110 transition-transform"></i> 
                    <span>BAIXAR PACOTE ZIP</span>
                    <div id="dlLoader" class="loader hidden border-white border-t-transparent ml-2"></div>
                </button>
                <p id="dlStatus" class="text-[10px] text-center text-yellow-500 mt-2 hidden animate-pulse"></p>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="flex-1 flex flex-col overflow-hidden relative bg-[#0b1120]">
            
            <!-- Barra de Busca (Aparece apenas na Home) -->
            <div id="top-search-bar" class="bg-slate-900/90 backdrop-blur border-b border-slate-800 p-4 z-30 flex justify-center shadow-lg">
                <div class="relative w-full max-w-2xl group">
                    <i class="fa-solid fa-search absolute left-4 top-3.5 text-slate-500 group-focus-within:text-blue-500 transition-colors"></i>
                    <input type="text" id="search" 
                        placeholder="Pesquisar na Nuvem (ex: Chrome, Steam, Adobe)..." 
                        class="w-full bg-slate-800 border border-slate-700 text-white rounded-xl py-3 pl-12 pr-24 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all shadow-inner placeholder-slate-500"
                        onkeydown="if(event.key==='Enter') searchOnline()">
                    
                    <button onclick="searchOnline()" class="absolute right-2 top-2 bg-slate-700 hover:bg-blue-600 text-white px-4 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-2 border border-slate-600 hover:border-blue-500">
                        <span id="btnSearchText">BUSCAR</span>
                        <div id="searchLoader" class="loader hidden"></div>
                    </button>
                </div>
            </div>

            <!-- Conteúdo com Scroll -->
            <div class="flex-1 overflow-y-auto p-6 scroll-smooth" id="mainScroll">
                
                <!-- ABA: BIBLIOTECA (HOME) -->
                <div id="tab-home" class="fade-in max-w-7xl mx-auto pb-20">
                    
                    <!-- Espaço Anúncio Topo -->
                    <div class="ad-space w-full h-[90px] mb-8 bg-slate-900/30 border border-dashed border-slate-800 rounded-xl flex items-center justify-center text-slate-600 text-xs uppercase select-none">
                        <span>Espaço Publicitário (Topo)</span>
                    </div>

                    <!-- Resumo da Fila -->
                    <div id="summaryArea" class="hidden mb-10 bg-slate-900 border border-slate-700 rounded-2xl p-5 shadow-xl">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-bold text-blue-400 uppercase tracking-wider flex items-center gap-2">
                                <i class="fa-solid fa-list-check"></i> Fila de Instalação
                            </h3>
                            <button onclick="clearAll()" class="text-xs text-red-400 hover:text-red-300 hover:underline font-medium">Limpar tudo</button>
                        </div>
                        <div id="summaryGrid" class="flex flex-wrap gap-2"></div>
                    </div>

                    <!-- Resultados Online -->
                    <div id="onlineResults" class="hidden mb-10 fade-in">
                        <div class="flex justify-between items-center mb-4 border-b border-slate-800 pb-2">
                            <h2 class="text-lg font-bold text-white flex items-center gap-2">
                                <span class="w-1.5 h-5 bg-blue-500 rounded-full"></span> Resultados da Web
                            </h2>
                            <button onclick="clearSearch()" class="text-xs text-slate-500 hover:text-white bg-slate-800 px-3 py-1 rounded hover:bg-slate-700 transition">
                                <i class="fa-solid fa-xmark mr-1"></i> Fechar
                            </button>
                        </div>
                        <div id="onlineGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                    </div>

                    <!-- Lista Fixa -->
                    <div id="fixedGrid"></div>
                    
                    <!-- Espaço Anúncio Rodapé -->
                    <div class="ad-space w-full h-[90px] mt-12 bg-slate-900/30 border border-dashed border-slate-800 rounded-xl flex items-center justify-center text-slate-600 text-xs uppercase select-none">
                        <span>Espaço Publicitário (Rodapé)</span>
                    </div>
                </div>

                <!-- ABA: SOBRE (INSTRUÇÕES) -->
                <div id="tab-about" class="hidden fade-in max-w-3xl mx-auto pt-10">
                    <div class="bg-slate-900 border border-slate-700 rounded-2xl p-8 shadow-2xl">
                        <div class="flex items-start gap-6 mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center text-3xl text-white shadow-xl"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-1">Sobre o Winget Pro</h2>
                                <p class="text-blue-400 font-medium text-sm">Automatização Inteligente para Profissionais de TI</p>
                            </div>
                        </div>
                        
                        <div class="prose prose-invert max-w-none text-slate-300 space-y-6">
                            <p>Esta ferramenta foi criada para agilizar a configuração de novos computadores, permitindo criar pacotes de instalação personalizados em segundos.</p>

                            <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                                <h3 class="text-white font-bold mb-4 flex items-center gap-2">
                                    <i class="fa-solid fa-book-open text-emerald-500"></i> Como usar o pacote gerado:
                                </h3>
                                <ol class="list-decimal pl-5 space-y-3 text-sm text-slate-300">
                                    <li>Na aba <b>Biblioteca</b>, selecione os programas desejados.</li>
                                    <li>Clique no botão <b>BAIXAR PACOTE ZIP</b> na barra lateral.</li>
                                    <li>Extraia o arquivo <code>.zip</code> baixado no computador de destino.</li>
                                    <li>Execute o arquivo <b>Instalador.exe</b> (incluído no pacote).</li>
                                    <li>Aguarde a instalação automática terminar.</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ABA: DOAÇÕES -->
                <div id="tab-donate" class="hidden fade-in max-w-4xl mx-auto pt-6">
                    <div class="text-center mb-10">
                        <h2 class="text-3xl font-bold text-white mb-2">Apoie o Projeto</h2>
                        <p class="text-slate-400">Se esta ferramenta ajudou você a economizar tempo, considere fazer uma doação!</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        
                         <!-- PIX -->
                        <div class="donate-card rounded-2xl p-6 flex flex-col items-center text-center border border-slate-700">
                            <div class="w-16 h-16 bg-emerald-500/10 rounded-full flex items-center justify-center mb-4 text-emerald-400">
                                <i class="fa-brands fa-pix text-3xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-white mb-2">Pix</h3>
                            <p class="text-xs text-slate-400 mb-4">Transferência instantânea e sem taxas.</p>
                            
                            <div class="bg-slate-900 p-3 rounded-lg border border-slate-700 w-full mb-4">
                                <!-- Substitua pela sua chave PIX -->
                                <code class="text-sm font-mono text-emerald-400 select-all">anderson.tavares.silva
                                    @gmail.com</code>
                            </div>
                            
                            <!-- Exemplo de QR Code (Substitua a imagem) -->
                            <div class="w-32 h-32 bg-white p-2 rounded-lg mb-2">
                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=anderson.tavares.silva@gmail.com" alt="QR Code Pix" class="w-full h-full">
                            </div>
                        </div>


                        <!-- MERCADO PAGO -->
                        <div class="donate-card rounded-2xl p-6 flex flex-col items-center text-center border border-slate-700">
                            <div class="w-16 h-16 bg-sky-500/10 rounded-full flex items-center justify-center mb-4 text-sky-400">
                                <i class="fa-solid fa-handshake text-3xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-white mb-2">Mercado Pago</h3>
                            <p class="text-xs text-slate-400 mb-4">Link de Pagamento.</p>
                            <div class="bg-slate-900 p-3 rounded-lg border border-slate-700 w-full mb-4">
                                <!-- EDITE AQUI SUA CHAVE MP OU PIX DO MP -->
                                <code class="text-xs font-mono text-sky-400 select-all">click Abaixo</code>
                            </div>
                             <!-- EDITE O LINK AQUI PARA SEU LINK DE PAGAMENTO -->
                            <a href="https://link.mercadopago.com.br/anderson001" target="_blank" class="w-full bg-sky-600 hover:bg-sky-500 text-white font-bold py-2 px-4 rounded-lg transition">Ir para Mercado Pago</a>
                        </div>

                    </div>
                </div>

            </div>
        </main>
    </div>


    <!-- Toast -->
    <div id="toast" class="fixed bottom-8 right-8 bg-slate-800 border-l-4 border-green-500 text-white px-6 py-4 rounded-lg shadow-2xl translate-y-32 opacity-0 transition-all duration-300 z-50 flex items-center gap-3 border border-slate-700">
        <i class="fa-solid fa-check-circle text-green-500 text-xl"></i>
        <div><h4 class="font-bold text-sm">Adicionado</h4><p id="toastMsg" class="text-xs text-slate-400 truncate max-w-[150px]"></p></div>
    </div>

    <script>
        // DADOS FIXOS
        const db = [
            { cat: "Navegadores", icon: "fa-brands fa-chrome", apps: [
                {n:"Chrome",id:"Google.Chrome",i:"fa-brands fa-chrome text-red-500"},
                {n:"Firefox",id:"Mozilla.Firefox",i:"fa-brands fa-firefox-browser text-orange-500"},
                {n:"Edge",id:"Microsoft.Edge",i:"fa-brands fa-edge text-blue-500"},
                {n:"Brave",id:"Brave.Brave",i:"fa-brands fa-fort-awesome text-orange-600"}
            ]},
            { cat: "Essenciais", icon: "fa-solid fa-box-archive", apps: [
                {n:"WinRAR",id:"RARLab.WinRAR",i:"fa-solid fa-file-zipper text-purple-500"},
                {n:"7-Zip",id:"7zip.7zip",i:"fa-solid fa-box-open text-gray-400"},
                {n:"Visual C++",id:"Abbottsoftware.VcRedistAIO",i:"fa-brands fa-windows text-blue-400"},
                {n:"DirectX",id:"Microsoft.DirectX",i:"fa-solid fa-gamepad text-green-500"},
                {n:"Java",id:"Oracle.JavaRuntimeEnvironment",i:"fa-brands fa-java text-red-600"}
            ]},
            { cat: "Multimídia", icon: "fa-solid fa-play", apps: [
                {n:"VLC",id:"VideoLAN.VLC",i:"fa-solid fa-circle-play text-orange-500"},
                {n:"Spotify",id:"Spotify.Spotify",i:"fa-brands fa-spotify text-green-500"},
                {n:"K-Lite",id:"CodecGuide.K-LiteCodecPack.Mega",i:"fa-solid fa-film text-gray-400"}
            ]},
            { cat: "Ferramentas", icon: "fa-solid fa-wrench", apps: [
                {n:"AnyDesk",id:"AnyDeskSoftwareGmbH.AnyDesk",i:"fa-solid fa-desktop text-red-500"},
                {n:"TeamViewer",id:"TeamViewer.TeamViewer",i:"fa-solid fa-arrow-right-arrow-left text-blue-500"},
                {n:"Adobe Reader",id:"Adobe.Acrobat.Reader.64-bit",i:"fa-solid fa-file-pdf text-red-600"},
                {n:"LibreOffice",id:"TheDocumentFoundation.LibreOffice",i:"fa-solid fa-file-word text-white"},
                {n:"CrystalDisk",id:"CrystalDewWorld.CrystalDiskInfo",i:"fa-solid fa-hard-drive text-blue-300"}
            ]}
        ];

        const presets = {
            'basic': ['Google.Chrome','RARLab.WinRAR','Adobe.Acrobat.Reader.64-bit','VideoLAN.VLC'],
            'dev': ['Google.Chrome','Microsoft.VisualStudioCode','Git.Git','7zip.7zip'],
            'gamer': ['Valve.Steam','EpicGames.EpicGamesLauncher','Discord.Discord','Nvidia.GeForceExperience']
        };

        let queue = new Map();

        (function init() { renderFixed(); })();

        // --- NAVEGAÇÃO ---
        function switchTab(tabName) {
            document.getElementById('tab-home').classList.add('hidden');
            document.getElementById('tab-about').classList.add('hidden');
            document.getElementById('tab-donate').classList.add('hidden');
            
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            document.getElementById('mainScroll').scrollTop = 0;
            
            const activeCls = "bg-blue-600 text-white shadow-md";
            const inactiveCls = "text-slate-400 hover:bg-slate-800 hover:text-white";
            
            document.getElementById('nav-home').className = `w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl transition-all text-left ${tabName==='home'?activeCls:inactiveCls}`;
            document.getElementById('nav-about').className = `w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl transition-all text-left ${tabName==='about'?activeCls:inactiveCls}`;
            
            const donateBase = "w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl transition-all text-left group";
            const donateInactive = "text-slate-400 hover:bg-slate-800 hover:text-emerald-400";
            document.getElementById('nav-donate').className = `${donateBase} ${tabName==='donate'?activeCls:donateInactive}`;

            // Mostra a barra de pesquisa apenas na Home
            const searchBar = document.getElementById('top-search-bar');
            if(tabName === 'home') {
                searchBar.classList.remove('hidden');
                searchBar.classList.add('flex');
            } else {
                searchBar.classList.add('hidden');
                searchBar.classList.remove('flex');
            }
        }

        // --- UI RENDER ---
        function renderFixed() {
            const c = document.getElementById('fixedGrid'); c.innerHTML = '';
            db.forEach(cat => {
                c.innerHTML += `
                <div class="mb-8">
                    <div class="flex items-center gap-2 text-slate-400 border-b border-slate-800 pb-2 mb-4">
                        <i class="${cat.icon} text-lg"></i>
                        <h3 class="font-bold text-xs tracking-widest uppercase text-slate-500">${cat.cat}</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        ${cat.apps.map(a => cardHtml(a.n, a.id, a.i)).join('')}
                    </div>
                </div>`;
            });
        }

        function cardHtml(n, id, i, online=false) {
            const chk = queue.has(id) ? 'checked' : '';
            const sn = n.replace(/'/g,""); const sid = id.replace(/'/g,""); const si = (i||"").replace(/'/g,"");
            const fn = `toggle(this, '${sn}','${sid}','${si}')`;
            
            let icon = si.startsWith('http') ? `<img src="${si}" class="w-6 h-6 object-contain" onerror="this.style.display='none';this.nextElementSibling.style.display='block'"><i class="fa-solid fa-box-open text-lg hidden text-slate-500"></i>` : `<i class="${si||getIcon(n)} text-xl"></i>`;
            
            return `
            <label class="app-card relative block p-4 rounded-xl cursor-pointer select-none h-full group">
                <input type="checkbox" class="app-checkbox hidden" value="${sid}" onchange="${fn}" ${chk}>
                <div class="app-content p-4 rounded-xl flex items-center gap-4 h-full border border-transparent transition-all relative -m-4">
                    <div class="w-12 h-12 bg-slate-900/80 rounded-lg flex items-center justify-center text-slate-400 shadow-inner ring-1 ring-white/5 group-hover:text-white transition-colors">${icon}</div>
                    <div class="min-w-0 flex-1">
                        <div class="font-bold text-sm text-slate-200 truncate leading-tight mb-1" title="${n}">${n}</div>
                        <div class="text-[10px] text-slate-500 truncate font-mono opacity-70" title="${id}">${id}</div>
                    </div>
                    <div class="check-indicator opacity-0 absolute top-3 right-3 text-blue-500 transition-all transform scale-50 bg-white rounded-full shadow-lg shadow-blue-500/40">
                        <i class="fa-solid fa-circle-check text-lg"></i>
                    </div>
                </div>
            </label>`;
        }

        function getIcon(n) {
            n = n.toLowerCase();
            if(n.includes('steam')) return 'fa-brands fa-steam';
            if(n.includes('chrome')||n.includes('browser')) return 'fa-brands fa-chrome';
            if(n.includes('office')||n.includes('word')) return 'fa-solid fa-file-word';
            return 'fa-solid fa-box-open';
        }

        function toggle(cb, n, id, i) {
            if(!i || i==='undefined' || i==='null') i = getIcon(n);
            if(cb.checked) { queue.set(id, {n, id, i}); showToast(`+ ${n}`); }
            else { queue.delete(id); }
            sync();
        }

        function sync() {
            document.querySelectorAll('.app-checkbox').forEach(c => c.checked = queue.has(c.value));
            const cnt = queue.size;
            
            const sidebarCount = document.getElementById('sidebarCount');
            if(sidebarCount) sidebarCount.innerText = cnt;
            
            const dlBtn = document.getElementById('dlBtn');
            const sideBtn = document.getElementById('sidebarDownloadBtn');
            
            if(cnt === 0) {
                if(dlBtn) dlBtn.disabled = true;
                if(sideBtn) sideBtn.disabled = true;
            } else {
                if(dlBtn) dlBtn.disabled = false;
                if(sideBtn) sideBtn.disabled = false;
            }
            
            const g = document.getElementById('summaryGrid');
            const a = document.getElementById('summaryArea');
            
            if(a && g) {
                g.innerHTML = '';
                if(cnt === 0) a.classList.add('hidden');
                else {
                    a.classList.remove('hidden');
                    queue.forEach(v => {
                        let ico = v.i.startsWith('http') ? `<img src="${v.i}" class="w-4 h-4 object-contain">` : `<i class="${v.i} text-xs"></i>`;
                        g.innerHTML += `<div class="bg-slate-800 border border-slate-700 px-3 py-2 rounded-lg flex items-center gap-2 cursor-pointer hover:border-red-500 hover:bg-red-500/10 transition-colors select-none group" onclick="queue.delete('${v.id}');sync();">${ico}<span class="text-xs text-slate-300 truncate max-w-[100px]">${v.n}</span><i class="fa-solid fa-xmark text-[10px] text-red-500 ml-auto opacity-50 group-hover:opacity-100"></i></div>`;
                    });
                }
            }
        }

        function clearAll() { queue.clear(); sync(); }
        
        function applyPreset(t) {
            const list = presets[t];
            if(list) {
                list.forEach(id => {
                    let name = id; let icon = '';
                    for(let c of db) {
                        let found = c.apps.find(a => a.id === id);
                        if(found) { name = found.n; icon = found.i; break; }
                    }
                    if(name === id) name = id.split('.').pop(); 
                    queue.set(id, {n: name, id, i: icon});
                });
                sync();
                showToast("Kit Aplicado");
            }
        }

        async function searchOnline() {
            const q = document.getElementById('search').value.trim();
            if(q.length < 2) return;
            
            const g = document.getElementById('onlineGrid');
            const a = document.getElementById('onlineResults');
            document.getElementById('btnSearchText').classList.add('hidden');
            document.getElementById('searchLoader').classList.remove('hidden');
            g.innerHTML = ''; a.classList.remove('hidden');
            
            try {
                const proxy = 'https://api.codetabs.com/v1/proxy?quest=';
                const url = encodeURIComponent(`https://api.winget.run/v2/packages?take=8&query=${q}`);
                const r = await fetch(proxy + url);
                const d = await r.json();
                
                if(d && d.Packages && d.Packages.length > 0) {
                    d.Packages.forEach(p => {
                        let icon = null;
                        if(p.Versions[0].Homepage) try { icon = `https://www.google.com/s2/favicons?domain=${new URL(p.Versions[0].Homepage).hostname}&sz=64`; } catch(e){}
                        g.innerHTML += cardHtml(p.Name || p.Id, p.Id, icon, true);
                    });
                } else g.innerHTML = '<div class="col-span-full text-center text-slate-500 py-4 border border-dashed border-slate-700 rounded-xl">Sem resultados.</div>';
            } catch(e) { g.innerHTML = '<div class="col-span-full text-center text-red-400 py-4">Erro na busca.</div>'; }
            finally { 
                document.getElementById('btnSearchText').classList.remove('hidden');
                document.getElementById('searchLoader').classList.add('hidden');
            }
        }

        function clearSearch() { document.getElementById('search').value = ''; document.getElementById('onlineResults').classList.add('hidden'); }
        function showToast(m) { const t = document.getElementById('toast'); t.querySelector('p').innerText = m; t.classList.remove('translate-x-full', 'opacity-0'); setTimeout(() => t.classList.add('translate-x-full', 'opacity-0'), 3000); }

        // --- DOWNLOAD PACKAGE ---
        async function downloadPackage() {
            if(queue.size === 0) return;
            
            const btn = document.getElementById('sidebarDownloadBtn');
            const dlBtn = document.getElementById('dlBtn');
            const loader = document.getElementById('dlLoader');
            const status = document.getElementById('dlStatus');
            
            if(btn) btn.disabled = true;
            if(dlBtn) dlBtn.disabled = true;
            if(loader) loader.classList.remove('hidden');
            if(status) status.classList.add('hidden');

            try {
                const zip = new JSZip();
                
                const apps = Array.from(queue.values()).map(v => ({ 
                    id: v.id, 
                    name: v.n, 
                    type: v.id.startsWith("Search:") ? "search" : "id" 
                }));
                zip.file("winget_config.json", JSON.stringify(apps, null, 2));

                try {
                    const exeRes = await fetch('Instalador.exe');
                    if(exeRes.ok) {
                        const exeBlob = await exeRes.blob();
                        zip.file("Instalador.exe", exeBlob);
                    } else {
                        throw new Error("404");
                    }
                } catch(e) {
                    if(status) {
                        status.innerText = "Aviso: 'Instalador.exe' não encontrado (Teste).";
                        status.classList.remove('hidden');
                    }
                    zip.file("AVISO.txt", "O arquivo Instalador.exe não foi encontrado no servidor. Por favor, coloque o executável nesta pasta.");
                }

                zip.file("LEIA-ME.txt", "1. Extraia tudo.\n2. Execute o Instalador.exe.");

                const content = await zip.generateAsync({type:"blob"});
                const url = window.URL.createObjectURL(content);
                const a = document.createElement("a");
                a.href = url;
                a.download = "Pacote_Winget_Pro.zip";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

            } catch(e) {
                console.error(e);
            } finally {
                if(btn) btn.disabled = false;
                if(dlBtn) dlBtn.disabled = false;
                if(loader) loader.classList.add('hidden');
            }
        }
    </script>
</body>
</html>